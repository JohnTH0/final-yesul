<!-- Header start  -->
<div th:fragment="header">
  <header class="gi-header">
    <!-- Loader -->
    <div id="gi-overlay">
      <div class="loader"></div>
    </div>

    <!-- Header Bottom  Start -->
    <div class="gi-header-bottom d-lg-block">
      <div class="container position-relative">
        <div class="row">
          <div class="gi-flex">
            <!-- Header Logo Start -->
            <div class="align-self-center gi-header-logo">
              <div class="header-logo">
                <a th:href="@{/}">
                  <img th:src="@{/assets/img/yesul/logo/main-logo-191x52.png}" alt="Site Logo"/>
                </a>
              </div>
            </div>
            <!-- Header Logo End -->
            <!-- Header Search Start -->
            <div class="align-self-center gi-header-search">
              <div class="header-search">
                <form class="gi-search-group-form" action="/alcohols/search" method="get" onsubmit="return validateSearch()">
                  <input class="form-control gi-search-bar" name="name" id="searchInput" placeholder="ì „í†µì£¼ ê²€ìƒ‰í•˜ê¸°" type="text"/>
                  <button class="search_submit" type="submit">
                    <i class="fi-rr-search"></i>
                  </button>
                </form>
              </div>
            </div>

            <script>
              function validateSearch() {
                const input = document.getElementById('searchInput').value.trim();
                if (input.length < 2) {
                  alert("ë‘ ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                  return false;
                }
                return true;
              }
            </script>
            <!-- Header Search End -->
            <!-- Header Button Start -->
            <div class="gi-header-action align-self-center">
              <div class="gi-header-buttons">
                <!-- Header User Start -->
                <div class="gi-acc-drop">
                  <a href="javascript:void(0)"
                     class="gi-header-btn gi-header-user dropdown-toggle gi-user-toggle"
                     title="Account">
                    <div class="header-icon">
                      <i class="fi-rr-user"></i>
                    </div>
                    <div class="gi-btn-desc">
                      <span class="gi-btn-title">ê³„ì •</span>
                      <span class="gi-btn-stitle">Login</span>
                    </div>
                  </a>
                  <ul class="gi-dropdown-menu">
                    <li><a class="dropdown-item" th:href="@{/user/regist}">íšŒì›ê°€ì…</a></li>
                    <li><a class="dropdown-item" th:href="@{/checkout.html}">ë¡œê·¸ì•„ì›ƒ</a></li>
                    <li><a class="dropdown-item" th:href="@{/login}">ë¡œê·¸ì¸</a></li>
                  </ul>
                </div>
                <!-- Header User End -->
                <!-- Header wishlist Start -->
                <a th:href="@{/wishlist.html}" class="gi-header-btn gi-wish-toggle" title="Wishlist">
                  <div class="header-icon">
                    <i class="fi-rr-heart"></i>
                  </div>
                  <div class="gi-btn-desc">
                    <span class="gi-btn-title">ê´€ì‹¬ëª©ë¡</span>
                    <span class="gi-btn-stitle"><b class="gi-wishlist-count">0</b>-items</span>
                  </div>
                </a>
                <!-- Header wishlist End -->
                <!-- Header Cart Start -->
                <!-- ì¢… ì•„ì´ì½˜ -->
                <a href="javascript:void(0)" class="gi-header-btn gi-cart-toggle" title="ì•Œë¦¼">
                  <div class="header-icon" style="position: relative;">
                    <i class="fi-rr-comments-question"></i>
                    <span id="header-notify-badge"
                          style="
        position: absolute;
        top: -4px;
        right: -8px;
        min-width: 16px;
        height: 16px;
        background: red;
        color: #fff;
        font-size: 12px;
        border-radius: 50%;
        text-align: center;
        line-height: 16px;
      ">

    </span>
                  </div>
                  <div class="gi-btn-desc">
                    <span class="gi-btn-title">ì•Œë¦¼</span>
                  </div>
                </a>

                <!-- Header Cart End -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Header Button End -->
    <div class="gi-header-cat d-none d-lg-block">
      <div class="container position-relative">
        <div class="gi-nav-bar">

          <!-- Main Menu Start -->
          <div id="gi-main-menu-desk" class="d-none d-lg-block sticky-nav">
            <div class="nav-desk">
              <div class="row">
                <div class="col-md-12 align-self-center">
                  <div class="gi-main-menu">
                    <ul>
                      <li class="non-drop">
                        <a th:href="@{/notices}">ê³µì§€ì‚¬í•­</a>
                      </li>
                      <li class="dropdown drop-list">
                        <a href="javascript:void(0)" class="dropdown-arrow">ì „í†µì£¼<i
                          class="fi-rr-angle-small-right"></i></a>
                        <ul class="sub-menu">
                          <li><a th:href="@{/alcohols/unrefined-rice-wine}">íƒì£¼</a>
                          </li>
                          <li><a th:href="@{/alcohols/herbal-rice-wine}">ì•½ì£¼</a>
                          </li>
                          <li><a th:href="@{/alcohols/clear-rice-wine}">ì²­ì£¼</a>
                          </li>
                          <li><a th:href="@{/alcohols/fruit-wine}">ê³¼ì‹¤ì£¼</a>
                          </li>
                          <li><a th:href="@{/alchols/distilled-liquor}">ì¦ë¥˜ì£¼</a>
                          </li>
                          <li><a th:href="@{/alcohols/liqueur}">ë¦¬íë¥´</a>
                          </li>
                        </ul>
                      </li>
                      <li class="non-drop"><a th:href="@{/alcohols/ai}">AI ì£¼ë½ì´</a>
                      </li>
                      <li class="dropdown drop-list">
                        <a href="javascript:void(0)" class="dropdown-arrow">ì»¤ë®¤ë‹ˆí‹°<i
                          class="fi-rr-angle-small-right"></i></a>
                        <ul class="sub-menu">
                          <li><a th:href="@{/community/recipe}">ë ˆì‹œí”¼ ê²Œì‹œíŒ</a></li>
                          <li><a th:href="@{/community/info}">ì •ë³´ ê²Œì‹œíŒ</a></li>
                          <li><a th:href="@{/community/free}">ììœ  ê²Œì‹œíŒ</a></li>
                        </ul>
                      </li>
                      <li class="dropdown drop-list">
                        <a href="javascript:void(0)" class="dropdown-arrow">Pages<i
                          class="fi-rr-angle-small-right"></i></a>
                        <ul class="sub-menu">
                          <li><a th:href="@{/about-us.html}">About Us</a></li>
                          <li><a th:href="@{/contact-us.html}">Contact Us</a></li>
                          <li><a th:href="@{/cart.html}">Cart</a></li>
                          <li><a th:href="@{/checkout.html}">Checkout</a></li>
                          <li><a th:href="@{/compare.html}">Compare</a></li>
                          <li><a th:href="@{/faq.html}">FAQ</a></li>
                          <li><a th:href="@{/login.html}">Login</a></li>
                        </ul>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Main Menu End -->

        </div>
      </div>
    </div>
    <!-- Header menu End -->

    <!-- Mobile Menu sidebar Start -->
    <div class="gi-mobile-menu-overlay"></div>
    <div id="gi-mobile-menu" class="gi-mobile-menu">
      <div class="gi-menu-title">
        <span class="menu_title">My Menu</span>
        <button class="gi-close-menu">Ã—</button>
      </div>
      <div class="gi-menu-inner">
        <div class="gi-menu-content">
          <ul>
            <li class="dropdown drop-list">
              <a href="javascript:void(0)" class="dropdown-arrow">Home</a>
              <ul class="sub-menu">
                <li><a href="index.html">Grocery</a></li>
                <li><a href="demo-2.html">Fashion</a></li>
                <li><a href="demo-3.html">Fashion 2</a></li>
              </ul>
            </li>
            <li><a href="javascript:void(0)">Categories</a>
              <ul class="sub-menu">
                <li>
                  <a href="javascript:void(0)">Classic Variation</a>
                  <ul class="sub-menu">
                    <li><a href="shop-left-sidebar-col-3.html">Left sidebar 3 column</a></li>
                    <li><a href="shop-left-sidebar-col-4.html">Left sidebar 4 column</a></li>
                    <li><a href="shop-right-sidebar-col-3.html">Right sidebar 3 column</a></li>
                    <li><a href="shop-right-sidebar-col-4.html">Right sidebar 4 column</a></li>
                    <li><a href="shop-full-width.html">Full width 4 column</a></li>
                  </ul>
                </li>
                <li>
                  <a href="javascript:void(0)">Classic Variation</a>
                  <ul class="sub-menu">
                    <li><a href="shop-banner-left-sidebar-col-3.html">Banner left sidebar 3 column</a></li>
                    <li><a href="shop-banner-left-sidebar-col-4.html">Banner left sidebar 4 column</a></li>
                    <li><a href="shop-banner-right-sidebar-col-3.html">Banner right sidebar 3 column</a></li>
                    <li><a href="shop-banner-right-sidebar-col-4.html">Banner right sidebar 4 column</a></li>
                    <li><a href="shop-banner-full-width.html">Banner Full width 4 column</a></li>
                  </ul>
                </li>
                <li>
                  <a href="javascript:void(0)">Columns Variation</a>
                  <ul class="sub-menu">
                    <li><a href="shop-full-width-col-3.html">3 Columns full width</a></li>
                    <li><a href="shop-full-width-col-4.html">4 Columns full width</a></li>
                    <li><a href="shop-full-width-col-5.html">5 Columns full width</a></li>
                    <li><a href="shop-full-width-col-6.html">6 Columns full width</a></li>
                    <li><a href="shop-banner-full-width-col-3.html">Banner 3 Columns</a></li>
                  </ul>
                </li>
                <li>
                  <a href="javascript:void(0)">List Variation</a>
                  <ul class="sub-menu">
                    <li><a href="shop-list-left-sidebar.html">Shop left sidebar</a></li>
                    <li><a href="shop-list-right-sidebar.html">Shop right sidebar</a></li>
                    <li><a href="shop-list-banner-left-sidebar.html">Banner left sidebar</a></li>
                    <li><a href="shop-list-banner-right-sidebar.html">Banner right sidebar</a></li>
                    <li><a href="shop-list-full-col-2.html">Full width 2 columns</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="javascript:void(0)">Products</a>
              <ul class="sub-menu">
                <li>
                  <a href="javascript:void(0)">Product page</a>
                  <ul class="sub-menu">
                    <li><a href="product-left-sidebar.html">Product left sidebar</a></li>
                    <li><a href="product-right-sidebar.html">Product right sidebar</a></li>
                  </ul>
                </li>
                <li>
                  <a href="javascript:void(0)">Product accordion</a>
                  <ul class="sub-menu">
                    <li><a href="product-accordion-left-sidebar.html">left sidebar</a></li>
                    <li><a href="product-accordion-right-sidebar.html">right sidebar</a></li>
                  </ul>
                </li>
                <li><a href="product-full-width.html">product full width</a></li>
                <li><a href="product-accordion-full-width.html">accordion full width</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="javascript:void(0)">Blog</a>
              <ul class="sub-menu">
                <li><a href="blog-left-sidebar.html">Blog left sidebar</a></li>
                <li><a href="blog-right-sidebar.html">Blog right sidebar</a></li>
                <li><a href="blog-detail-left-sidebar.html">Blog detail left sidebar</a></li>
                <li><a href="blog-detail-right-sidebar.html">Blog detail right sidebar</a></li>
                <li><a href="blog-full-width.html">Blog full width</a></li>
                <li><a href="blog-detail-full-width.html">Blog detail full width</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="javascript:void(0)">Pages</a>
              <ul class="sub-menu">
                <li><a href="about-us.html">About Us</a></li>
                <li><a href="contact-us.html">Contact Us</a></li>
                <li><a href="cart.html">Cart</a></li>
                <li><a href="checkout.html">Checkout</a></li>
                <li><a href="compare.html">Compare</a></li>
                <li><a href="faq.html">FAQ</a></li>
                <li><a href="login.html">Login</a></li>
              </ul>
            </li>
          </ul>
        </div>
        <div class="header-res-lan-curr">
          <!-- Social Start -->
          <div class="header-res-social">
            <div class="header-top-social">
              <ul class="mb-0">
                <li class="list-inline-item"><a href="#"><i class="gicon gi-facebook"></i></a></li>
                <li class="list-inline-item"><a href="#"><i class="gicon gi-twitter"></i></a></li>
                <li class="list-inline-item"><a href="#"><i class="gicon gi-instagram"></i></a></li>
                <li class="list-inline-item"><a href="#"><i class="gicon gi-linkedin"></i></a></li>
              </ul>
            </div>
          </div>
          <!-- Social End -->
        </div>
      </div>
    </div>
    <!-- Mobile Menu sidebar End -->
  </header>
  <script>
    window.addEventListener('load', function () {
      const overlay = document.getElementById('gi-overlay');
      if (overlay) {
        overlay.style.display = 'none';
      }
    });
  </script>
  <!-- Header End  -->

  <!-- Cart sidebar Start -->
  <div th:fragment="adminNotifySidebar">
    <!-- ì˜¤ë²„ë ˆì´ -->
    <div class="gi-side-cart-overlay"></div>

    <!-- ì‚¬ì´ë“œ ì•Œë¦¼ íŒ¨ë„ -->
    <div id="gi-side-cart" class="gi-side-cart">
      <div class="gi-cart-inner">
        <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
        <div class="gi-cart-top">
          <div class="gi-cart-title">
            <span class="cart_title">ì•Œë¦¼ì„¼í„°</span>
            <span id="notify-count" class="main-label-note-new">0</span>
            <a href="javascript:void(0)" class="gi-cart-close">
              <i class="fi-rr-cross-small"></i>
            </a>
          </div>

          <!-- íƒ­ ë²„íŠ¼ -->
          <ul class="nav nav-tabs">
            <li>
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#alert-tab" type="button">
                ì•Œë¦¼
              </button>
            </li>
            <li>
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#message-tab" type="button">
                1:1 ë¬¸ì˜
              </button>
            </li>
          </ul>
        </div>

        <!-- íƒ­ ì»¨í…ì¸  -->
        <div class="tab-content">
          <!-- ì¼ë°˜ ì•Œë¦¼ íƒ­ -->
          <div id="alert-tab" class="tab-pane fade show active" role="tabpanel">
            <ul id="alert-list">
              <li class="check">
              </li>
            </ul>
          </div>

          <!-- 1:1 ë¬¸ì˜ íƒ­ -->
          <div id="message-tab" class="tab-pane fade" role="tabpanel">
            <div class="gi-message-list">
              <ul id="message-list">
                <li class="check">
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--  ì•Œë¦¼ ë‹«ê¸°ìš© ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
    <style>
      .gi-message-list,
      #message-list {
        display: flex;
        flex-direction: column !important;
      }

      .close-alert-btn {
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        margin-left: 8px;
        color: #888;
        transition: color 0.2s ease;
      }
      .close-alert-btn:hover {
        color: #ff4d4f;
      }
      .detail {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .detail div {
        flex: 1;
      }
    </style>




    <!-- Cart sidebar End -->
    <script th:inline="javascript">
      const receiverId = [[${receiverId}]];
      const receiverType = 'USER';
      if (receiverId != null && receiverId !== 0) {

        // [1:1 ë¬¸ì˜] ì´ˆê¸° ì•ˆ ì½ì€ ì•Œë¦¼ ê°€ì ¸ì˜¤ê¸°
        fetch(`/notifications/${receiverType}/${receiverId}`)
          .then(res => res.json())
          .then(data => {
            const count = data.length;
            document.getElementById('notify-count').textContent = count;

            const messageList = document.getElementById('message-list'); // 1:1 ë¬¸ì˜
            const alertList = document.getElementById('alert-list');     // ëŒ“ê¸€ ì•Œë¦¼

            data.forEach(msg => {
              let li = document.createElement('li');

              if (msg.type === 'CHAT') {
                // ğŸ‘‰ 1:1 ë¬¸ì˜ ì•Œë¦¼
                li.innerHTML = `
          <div class="icon gi-success">
            <i class="ri-check-double-line"></i>
          </div>
          <div class="detail">
            <div>
              <a href="/users/chatroom?adminId=${msg.senderId}" class="name">${msg.senderId}</a>
              <p class="time">${new Date(msg.createdAt).toLocaleString()}</p>
              <p class="message">${msg.content}</p>
            </div>
            <span class="close-alert-btn" data-id="${msg.id}">&times;</span>
          </div>
        `;
                messageList.insertBefore(li, messageList.firstChild);

              } else if (msg.type === 'COMMENT') {
                // ğŸ‘‰ ëŒ“ê¸€ ì•Œë¦¼
                li.innerHTML = `
          <div class="icon gi-info">
            <i class="ri-chat-3-line"></i>
          </div>
          <div class="detail">
            <div>
              <a href="community/recipe/${msg.targetId}" class="name">USER${msg.senderId}ë‹˜ì´ ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.</a>
              <p class="time">${new Date(msg.createdAt).toLocaleString()}</p>
              <p class="message">${msg.content}</p>
            </div>
            <span class="close-alert-btn" data-id="${msg.id}">&times;</span>
          </div>
        `;
                alertList.insertBefore(li, alertList.firstChild);
              }
            });

            attachCloseEvent();
          });


        //  ì‹¤ì‹œê°„ ì•Œë¦¼ Push
        const socket = new WebSocket(`ws://${location.host}/ws/notification`);
        socket.onopen = () => console.log(" ì•Œë¦¼ WebSocket ì—°ê²°ë¨");
        socket.onmessage = (event) => {
          const msg = JSON.parse(event.data);
          console.log('âœ… íŒŒì‹± ê²°ê³¼', msg);
          if (msg.type === 'CHAT') {
            // ê¸°ì¡´ ì±„íŒ… ì•Œë¦¼
            const list = document.getElementById('message-list');
            const li = document.createElement('li');
            li.innerHTML = `
      <div class="icon gi-success">
        <i class="ri-check-double-line"></i>
      </div>
      <div class="detail">
        <div>
          <a href="/admin/chatroom/${msg.targetId}" class="name">${msg.senderId}</a>
          <p class="time">${new Date(msg.createdAt).toLocaleString()}</p>
          <p class="message">${msg.content}</p>
        </div>
        <span class="close-alert-btn" data-id="${msg.id}">&times;</span>
      </div>
    `;
            list.insertBefore(li, list.firstChild);

          } else if (msg.type === 'COMMENT') {
            //  ëŒ“ê¸€ ì•Œë¦¼ ì²˜ë¦¬
            const list = document.getElementById('alert-list');
            const li = document.createElement('li');
            li.innerHTML = `
      <div class="icon gi-info">
        <i class="ri-chat-3-line"></i>
      </div>
      <div class="detail">
        <div>
          <a href="/posts/${msg.targetId}" class="name">${msg.senderId}ë‹˜ì´ ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.</a>
          <p class="time">${new Date(msg.createdAt).toLocaleString()}</p>
          <p class="message">${msg.content}</p>
        </div>
        <span class="close-alert-btn" data-id="${msg.id}">&times;</span>
      </div>
    `;
            list.insertBefore(li, list.firstChild);
          }

          const badge = document.getElementById('notify-count');
          badge.textContent = parseInt(badge.textContent) + 1;

          attachCloseEvent();
        };
      }
      // X ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      function attachCloseEvent() {
        document.querySelectorAll('.close-alert-btn').forEach(btn => {
          btn.onclick = () => {
            const li = btn.closest('li');
            li.remove();

            const badge = document.getElementById('notify-count');
            badge.textContent = Math.max(parseInt(badge.textContent) - 1, 0);

            const id = btn.dataset.id;
            fetch(`/notifications/${id}/read`, { method: 'PATCH' });
          };
        });
      }
    </script>
  </div>
</div>